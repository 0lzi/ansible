---
ansible-lint:
  stage: lint
  tags:
    - ansible
  rules:
    - if: $CI_PIPELINE_SOURCE == 'merge_request_event'
  allow_failure: true
  before_script:
    - sed -i '/vault_password_file/d' ${ANSIBLE_CONFIG}
  script:
    - ansible-lint -f codeclimate | python3 -m json.tool | tee gl-code-quality-report.json || true
  artifacts:
    reports:
      codequality:
        - gl-code-quality-report.json
    expire_in: 1 week
